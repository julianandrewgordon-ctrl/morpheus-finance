# New Features Guide

## Overview

The following features have been added to the Personal Finance Manager:

1. ✅ **Batch Upload Rules** - Upload multiple rules at once via CSV or JSON
2. ✅ **Delete Rules** - Delete individual rules from the Actions menu
3. ✅ **Edit Scenario Names** - Rename scenarios with a simple modal
4. ✅ **Set Cash Flow Start Date** - Control which date the cash flow table starts from
5. ✅ **Functional Include Checkbox** - Toggle rules on/off to include/exclude from calculations

---

## 1. Batch Upload Rules

### How to Use

1. Navigate to **Recurring Rules** tab
2. Click the **"Batch Upload"** button (with upload icon)
3. A modal will open with instructions
4. Paste your rules in either CSV or JSON format
5. Click **"Upload Rules"**

### CSV Format

Each line should contain: `Name, Amount, Type, Account, Frequency, Effective Date, End Date, Description`

**Example:**
```csv
Salary, 5000, Income, BOA, Monthly, 2025-01-01
Rent, -2000, Cash Expense, BOA, Monthly, 2025-01-01
Groceries, -600, Variable Expense, PNC, Bi-weekly, 2025-01-01
Gym Membership, -50, Cash Expense, PNC, Monthly, 2025-01-01, 2025-06-30
```

**Field Details:**
- **Name** (required): Transaction name
- **Amount** (required): Positive for income, negative for expenses
- **Type** (optional, default: Cash Expense): Income, Cash Expense, Variable Expense, etc.
- **Account** (optional, default: BOA): BOA, PNC, Other
- **Frequency** (optional, default: Monthly): Monthly, Bi-weekly, Weekly, One-time
- **Effective Date** (optional, default: today): YYYY-MM-DD format
- **End Date** (optional): YYYY-MM-DD format or leave blank for perpetual
- **Description** (optional): Notes about the transaction

### JSON Format

One JSON object per line with the following fields:

**Example:**
```json
{"name": "Salary", "amount": 5000, "type": "Income", "account": "BOA", "frequency": "Monthly", "effectiveDate": "2025-01-01"}
{"name": "Rent", "amount": -2000, "type": "Cash Expense", "account": "BOA", "frequency": "Monthly", "effectiveDate": "2025-01-01"}
```

### Success/Error Messages

- **Success**: Green flash message showing "Successfully added X rule(s)"
- **Error**: Red flash message if parsing fails with details

### Tips

- You can mix and match CSV and JSON formats in the same upload
- Blank lines are ignored
- Invalid lines are skipped
- All uploaded rules are automatically set to "Include = true"

---

## 2. Delete Rules

### How to Use

1. Navigate to **Recurring Rules** tab
2. Find the rule you want to delete
3. Click the **Actions** dropdown (three dots icon) in the last column
4. Select **"Delete"** from the menu
5. The rule will be immediately removed
6. A success message will confirm the deletion

### What Happens

- The rule is permanently removed from the list
- All future cash flow entries generated by this rule will no longer appear
- Historical entries (if any) are preserved
- A green flash message confirms: "Deleted rule: [Rule Name]"

### Undo

Currently, there is no undo function. To restore a deleted rule:
- Use the "Quick Add Transaction" button to recreate it manually
- Or use "Batch Upload" to re-import it

---

## 3. Edit Scenario Names

### How to Use

1. Navigate to **Dashboard** tab
2. Find the **Scenario Selector** section
3. Locate the scenario you want to rename
4. Click the **Edit icon** (pencil) next to the scenario button
5. A modal will open with the current name
6. Enter the new name
7. Click **"Save"**

### Notes

- Only non-baseline scenarios can be renamed
- The "Committed Plan" (baseline) cannot be renamed
- Scenario names must not be empty
- A success message confirms the update

### Example Use Cases

- Rename "Gift Card A" to "Holiday Gift Budget"
- Rename "Car Purchase" to "Used Car - Honda Civic"
- Create descriptive names for what-if scenarios

---

## 4. Set Cash Flow Start Date

### How to Use

1. Navigate to **Dashboard** tab
2. Find the **Cash Flow Table** section
3. In the header, locate the **"Start Date"** field
4. Click the date picker
5. Select a new start date from the calendar
6. The table will automatically update to show data from that date forward

### What It Does

- Filters the cash flow table to only show dates >= the selected start date
- Useful for focusing on recent data or future projections
- Does not delete or modify any data, just filters the view
- Default start date is May 24, 2025

### Example Use Cases

- Set to today's date to see only future projections
- Set to first of the month to see current month data
- Set to 180 days ago to see full historical view

### Date Format

- Use the calendar picker for easy selection
- Or type in YYYY-MM-DD format (e.g., 2025-06-01)

---

## 5. Functional Include Checkbox

### How to Use

1. Navigate to **Recurring Rules** tab
2. Find any rule in the table
3. Click the **checkbox** in the first column (✓)
4. The checkbox will toggle between checked and unchecked
5. The rule's include status is immediately updated

### What It Does

**When Checked (✓):**
- Rule is **included** in cash flow calculations
- Transactions from this rule appear in the cash flow table
- Rule contributes to running balance

**When Unchecked (☐):**
- Rule is **excluded** from cash flow calculations
- Transactions from this rule do NOT appear in the cash flow table
- Rule does NOT contribute to running balance
- Rule remains in the list but is effectively "disabled"

### Visual Indicators

- Unchecked rules may appear grayed out or with reduced opacity (depending on styling)
- The checkbox state is immediately visible
- No confirmation needed - toggle is instant

### Example Use Cases

- Temporarily disable a recurring expense to see impact on cash flow
- Exclude optional expenses when modeling tight budget scenarios
- Turn off seasonal expenses during off-season
- Disable rules that are on hold or pending

### Difference from Delete

| Action | Effect | Reversible | Data Preserved |
|--------|--------|------------|----------------|
| **Uncheck Include** | Excludes from calculations | ✅ Yes (just check again) | ✅ Yes (rule stays in list) |
| **Delete** | Removes from list | ❌ No (must re-add) | ❌ No (rule is gone) |

---

## Feature Interactions

### Batch Upload + Include Checkbox
- All batch uploaded rules are automatically set to Include = true
- You can uncheck them after upload if needed

### Delete + Include Checkbox
- Deleting a rule removes it completely, regardless of include status
- If you want to temporarily disable, use Include checkbox instead

### Start Date + Include Checkbox
- Start date filters the view by date
- Include checkbox filters which rules contribute to calculations
- Both work together: only included rules appear, and only dates >= start date show

### Scenario Names + Include Checkbox
- Scenario names are independent of rule include status
- Each scenario can have different draft rules with different include statuses

---

## Keyboard Shortcuts

| Action | Shortcut |
|--------|----------|
| Toggle Include Checkbox | Click or Space when focused |
| Open Batch Upload | (none - click button) |
| Close Modal | Esc |
| Submit Modal Form | Enter |

---

## Flash Messages

The app now shows flash messages (notifications) for:

- ✅ **Success**: Green banner at top
  - "Successfully added X rule(s)" (batch upload)
  - "Deleted rule: [name]" (delete)
  - "Scenario name updated successfully" (rename)

- ❌ **Error**: Red banner at top
  - "No valid rules found. Please check the format." (batch upload)
  - "Error parsing rules: [details]" (batch upload)

- ℹ️ **Info**: Blue banner at top
  - "Edit functionality coming soon" (edit action)

All flash messages are dismissible (click X to close).

---

## Tips & Best Practices

### Batch Upload
1. **Test with a few rules first** before uploading many
2. **Keep a backup** of your rules in a text file
3. **Use consistent formatting** for easier parsing
4. **Check the success message** to confirm all rules were added

### Delete
1. **Double-check before deleting** - there's no undo
2. **Consider using Include checkbox** instead for temporary exclusion
3. **Export your rules** regularly as backup before bulk deletions

### Include Checkbox
1. **Use for what-if scenarios** - uncheck optional expenses to see impact
2. **Seasonal expenses** - uncheck when not in season
3. **Pending transactions** - uncheck until confirmed
4. **Quick budget cuts** - uncheck non-essential items

### Start Date
1. **Set to today** to focus on future projections
2. **Set to first of month** for monthly reviews
3. **Set to 180 days ago** for full historical view
4. **Combine with filters** for powerful data analysis

### Scenario Names
1. **Use descriptive names** that explain the scenario
2. **Include key details** like amounts or dates
3. **Keep names concise** for better display
4. **Update names** as scenarios evolve

---

## Troubleshooting

### Batch Upload Not Working
- **Check format**: Ensure CSV has commas, JSON has valid syntax
- **Check required fields**: Name and Amount are required
- **Check for errors**: Look at the error message for details
- **Try one line**: Test with a single rule first

### Delete Not Working
- **Check permissions**: Ensure you're not trying to delete a protected rule
- **Refresh page**: If UI is stuck, refresh and try again
- **Check flash message**: Look for error details

### Include Checkbox Not Responding
- **Click directly on checkbox**: Not the row
- **Wait for update**: Should be instant but may take a moment
- **Check if rule is locked**: Some rules may be read-only

### Start Date Not Filtering
- **Check date format**: Should be YYYY-MM-DD
- **Check date range**: Ensure date is within your data range
- **Refresh table**: Try changing date back and forth

### Scenario Name Not Saving
- **Check for empty name**: Name cannot be blank
- **Check for special characters**: Some characters may not be allowed
- **Try shorter name**: Very long names may be truncated

---

## Future Enhancements

Potential features to add:
- [ ] Bulk delete (select multiple rules)
- [ ] Bulk edit (change multiple rules at once)
- [ ] Undo/redo for deletions
- [ ] Import from file (CSV/JSON file upload)
- [ ] Export selected rules
- [ ] Duplicate rule function
- [ ] Rule templates
- [ ] Drag-and-drop reordering
- [ ] Advanced filtering (date ranges, amount ranges)
- [ ] Rule validation warnings

---

## API Reference (for developers)

### New Props

**RecurringRules Component:**
```jsx
<RecurringRules
  rules={rules}                    // Array of rule objects
  onAddRule={handleAddRule}        // Function to open add modal
  onBatchAdd={handleBatchAdd}      // Function(rules[]) to add multiple rules
  onDeleteRule={handleDeleteRule}  // Function(ruleId) to delete a rule
  onToggleInclude={handleToggle}   // Function(ruleId) to toggle include
  onUpdateRule={handleUpdateRule}  // Function(ruleId, updates) to update rule
/>
```

**Dashboard Component:**
```jsx
<Dashboard
  data={data}                           // Full data object
  onQuickAdd={handleQuickAdd}           // Function to open quick add modal
  cashFlowStartDate={startDate}         // String: YYYY-MM-DD format
  onStartDateChange={handleDateChange}  // Function(dateString) to update start date
  onUpdateScenario={handleUpdateScen}   // Function(scenarioId, updates) to update scenario
/>
```

**CashFlowTable Component:**
```jsx
<CashFlowTable
  data={cashFlowData}        // Array of cash flow entries
  startDate={startDate}      // String: YYYY-MM-DD format (filters data)
/>
```

---

## Summary

All requested features have been implemented:

✅ **Batch Upload** - Upload multiple rules via CSV or JSON
✅ **Delete Rules** - Remove rules via Actions dropdown
✅ **Edit Scenario Names** - Rename scenarios with modal
✅ **Set Start Date** - Control cash flow table start date
✅ **Functional Include** - Toggle rules on/off with checkbox

The app is now more powerful and flexible for managing your financial data!
